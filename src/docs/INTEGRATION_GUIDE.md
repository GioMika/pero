# üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–ù–¢–ï–ì–†–ê–¶–ò–ò PEN TOOL

## üì¶ –ß—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å:

1. **`penTool_complete.ts`** - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Pen Tool
2. **`convertAnchorTool.ts`** - Convert Anchor Point Tool (Shift+C)
3. **`PEN_TOOL_USER_GUIDE.md`** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üöÄ –®–ê–ì 1: –ó–∞–º–µ–Ω–∏ —Å—Ç–∞—Ä—ã–π PenTool

```bash
# –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª
rm src/widgets/fabric-editor/lib/penTool.ts

# –°–∫–æ–ø–∏—Ä—É–π –Ω–æ–≤—ã–π
cp penTool_complete.ts src/widgets/fabric-editor/lib/penTool.ts
```

---

## üîß –®–ê–ì 2: –î–æ–±–∞–≤—å ConvertAnchorTool

```bash
# –°–∫–æ–ø–∏—Ä—É–π –≤ —Ç—É –∂–µ –ø–∞–ø–∫—É
cp convertAnchorTool.ts src/widgets/fabric-editor/lib/convertAnchorTool.ts
```

---

## üé® –®–ê–ì 3: –û–±–Ω–æ–≤–∏ Toolbar

### –§–∞–π–ª: `src/widgets/toolbar/ui/Toolbar.tsx`

–î–æ–±–∞–≤—å –∏–º–ø–æ—Ä—Ç:

```typescript
import { ConvertAnchorTool } from '@widgets/fabric-editor/lib/convertAnchorTool';
```

–î–æ–±–∞–≤—å –≤ state:

```typescript
const [convertAnchorTool, setConvertAnchorTool] = useState<ConvertAnchorTool | null>(null);
```

–î–æ–±–∞–≤—å useEffect –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```typescript
useEffect(() => {
  if (canvas) {
    // ... existing tools ...
    
    const convertTool = new ConvertAnchorTool(canvas);
    setConvertAnchorTool(convertTool);
    
    return () => {
      convertTool.deactivate();
    };
  }
}, [canvas]);
```

–î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

```typescript
const handleConvertAnchor = () => {
  deactivateAllTools();
  setActiveTool('convert-anchor');
  convertAnchorTool?.activate();
  console.log('üîß Convert Anchor Tool activated');
};
```

–î–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É –≤ JSX (–ø–æ—Å–ª–µ Pen Tool):

```tsx
<button
  className={cn(styles.toolButton, activeTool === 'convert-anchor' && styles.active)}
  onClick={handleConvertAnchor}
  title="Convert Anchor Point (Shift+C)"
>
  üîß Convert
</button>
```

---

## ‚å®Ô∏è –®–ê–ì 4: –î–æ–±–∞–≤—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

### –§–∞–π–ª: `src/widgets/fabric-editor/ui/FabricEditor.tsx`

–î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à:

```typescript
useEffect(() => {
  const handleKeyPress = (e: KeyboardEvent) => {
    // Shift + C = Convert Anchor Tool
    if (e.shiftKey && e.key === 'C') {
      handleConvertAnchor(); // –§—É–Ω–∫—Ü–∏—è –∏–∑ Toolbar
      e.preventDefault();
    }
    
    // P = Pen Tool
    if (e.key === 'p' || e.key === 'P') {
      handlePenTool(); // –§—É–Ω–∫—Ü–∏—è –∏–∑ Toolbar
      e.preventDefault();
    }
    
    // A = Direct Selection
    if (e.key === 'a' || e.key === 'A') {
      handleDirectSelect(); // –§—É–Ω–∫—Ü–∏—è –∏–∑ Toolbar
      e.preventDefault();
    }
  };

  document.addEventListener('keydown', handleKeyPress);
  return () => document.removeEventListener('keydown', handleKeyPress);
}, []);
```

---

## üéØ –®–ê–ì 5: –û–±–Ω–æ–≤–∏ —Ç–∏–ø—ã

### –§–∞–π–ª: `src/shared/types/tools.ts`

–î–æ–±–∞–≤—å –Ω–æ–≤—ã–π —Ç–∏–ø:

```typescript
export type ToolType =
  | 'select'
  | 'direct-select'
  | 'pen'
  | 'convert-anchor'  // ‚Üê –ù–û–í–´–ô
  | 'text'
  | 'move'
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
```

---

## üìù –®–ê–ì 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–∫–æ–ø–∏—Ä—É–π `PEN_TOOL_USER_GUIDE.md` –≤ –ø–∞–ø–∫—É —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π:

```bash
cp PEN_TOOL_USER_GUIDE.md docs/PEN_TOOL_GUIDE.md
```

–ò–ª–∏ –¥–æ–±–∞–≤—å –≤ –≤–∏–¥–µ Help –º–æ–¥–∞–ª –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### –¢–µ—Å—Ç 1: –ü—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏
1. –ù–∞–∂–º–∏ `P`
2. –ö–ª–∏–∫–Ω–∏ 3 —Ä–∞–∑–∞ (—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫)
3. –ù–∞–≤–µ–¥–∏ –Ω–∞ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É
4. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–µ–ª–µ–Ω—ã–π –∫—Ä—É–∂–æ–∫
5. –ö–ª–∏–∫–Ω–∏ ‚Üí –ö–æ–Ω—Ç—É—Ä –∑–∞–º–∫–Ω–µ—Ç—Å—è

**‚úÖ –†–ê–ë–û–¢–ê–ï–¢:** –ï—Å–ª–∏ –∫–æ–Ω—Ç—É—Ä –∑–∞–º–∫–Ω—É–ª—Å—è –∏ –º–æ–∂–Ω–æ –∑–∞–ª–∏—Ç—å

---

### –¢–µ—Å—Ç 2: –ö—Ä–∏–≤—ã–µ –ë–µ–∑—å–µ
1. –ù–∞–∂–º–∏ `P`
2. –ö–ª–∏–∫–Ω–∏ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É
3. –ó–∞–∂–º–∏ –õ–ö–ú –∏ —Ç–∞—â–∏ –≤–≤–µ—Ä—Ö
4. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–∏–Ω–∏–µ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã
5. –û—Ç–ø—É—Å—Ç–∏ –õ–ö–ú
6. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Å—å –≤–ø—Ä–∞–≤–æ
7. –ó–∞–∂–º–∏ –õ–ö–ú –∏ —Ç–∞—â–∏ –≤–Ω–∏–∑
8. –û—Ç–ø—É—Å—Ç–∏

**‚úÖ –†–ê–ë–û–¢–ê–ï–¢:** –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∞—Å—å –ø–ª–∞–≤–Ω–∞—è –¥—É–≥–∞

---

### –¢–µ—Å—Ç 3: Shift constraint
1. –ù–∞–∂–º–∏ `P`
2. –ö–ª–∏–∫–Ω–∏ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É
3. –ó–∞–∂–º–∏ `Shift`
4. –î–≤–∏–≥–∞–π –∫—É—Ä—Å–æ—Ä
5. –õ–∏–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—Ç—å—Å—è –ø–æ —É–≥–ª–∞–º 45¬∞

**‚úÖ –†–ê–ë–û–¢–ê–ï–¢:** –ï—Å–ª–∏ –ª–∏–Ω–∏—è "–ø—Ä—ã–≥–∞–µ—Ç" –ø–æ —É–≥–ª–∞–º

---

### –¢–µ—Å—Ç 4: Convert Anchor (Shift+C)
1. –ù–∞—Ä–∏—Å—É–π –∫–≤–∞–¥—Ä–∞—Ç
2. –ù–∞–∂–º–∏ `ESC`
3. –ù–∞–∂–º–∏ `Shift + C`
4. –ö–ª–∏–∫–Ω–∏ –Ω–∞ –æ–¥–Ω—É –∏–∑ –ª–∏–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç–∞
5. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã –∏ –ª–∏–Ω–∏—è –∏–∑–æ–≥–Ω–µ—Ç—Å—è

**‚úÖ –†–ê–ë–û–¢–ê–ï–¢:** –ï—Å–ª–∏ –ª–∏–Ω–∏—è –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∞—Å—å –≤ –¥—É–≥—É

---

### –¢–µ—Å—Ç 5: Direct Selection
1. –°–æ–∑–¥–∞–π –∫–æ–Ω—Ç—É—Ä —Å –∫—Ä–∏–≤—ã–º–∏
2. –ù–∞–∂–º–∏ `A`
3. –ö–ª–∏–∫–Ω–∏ –Ω–∞ —Ç–æ—á–∫—É –∫–æ–Ω—Ç—É—Ä–∞
4. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã
5. –¢–∞—â–∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã
6. –§–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è

**‚úÖ –†–ê–ë–û–¢–ê–ï–¢:** –ï—Å–ª–∏ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏–≤—ã–µ

---

## üêõ –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "TypeScript –æ—à–∏–±–∫–∏"

**–ü—Ä–∏—á–∏–Ω–∞:** Fabric.js —Ç–∏–ø—ã

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:
// @ts-nocheck
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Canvas –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** Canvas –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
useEffect(() => {
  if (canvas) {
    const penTool = new PenTool(canvas);
    // ...
  }
}, [canvas]); // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç canvas!
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã –Ω–µ –≤–∏–¥–Ω—ã"

**–ü—Ä–∏—á–∏–Ω–∞:** Z-index –∏–ª–∏ —Å–ª–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í –º–µ—Ç–æ–¥–µ drawHandles():
this.canvas.add(circle);
this.canvas.bringToFront(circle); // ‚Üê –î–æ–±–∞–≤—å —ç—Ç–æ
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç"

**–ü—Ä–∏—á–∏–Ω–∞:** Event listener –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `document.addEventListener` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ useEffect

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–º—ã–∫–∞–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è"

**–ü—Ä–∏—á–∏–Ω–∞:** –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í checkClosePath():
if (distance < 15) { // –£–≤–µ–ª–∏—á—å –¥–æ 20-30 –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
```

---

## üé® –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø

### –¶–≤–µ—Ç–∞:

```typescript
// –í PenTool:
stroke: '#00aaff', // ‚Üê –ò–∑–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π —Ü–≤–µ—Ç
fill: '#ffffff',
```

### –†–∞–∑–º–µ—Ä—ã —Ç–æ—á–µ–∫:

```typescript
// –í drawAnchorPoint():
radius: 5, // ‚Üê –ò–∑–º–µ–Ω–∏ —Ä–∞–∑–º–µ—Ä —Ç–æ—á–µ–∫
```

### –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ snap-–∞:

```typescript
// –í checkClosePath():
if (distance < 15) { // ‚Üê –ò–∑–º–µ–Ω–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
```

---

## üìä PRODUCTION CHECKLIST

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –ø—Ä–æ–≤–µ—Ä—å:

- [ ] –í—Å–µ TypeScript –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –í—Å–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä—è–º—É—é –ª–∏–Ω–∏—é
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫—Ä–∏–≤—É—é –ë–µ–∑—å–µ
- [ ] –ú–æ–∂–Ω–æ –∑–∞–º–∫–Ω—É—Ç—å –∫–æ–Ω—Ç—É—Ä (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
- [ ] Shift constraint —Ä–∞–±–æ—Ç–∞–µ—Ç (45¬∞)
- [ ] Convert Anchor Tool —Ä–∞–±–æ—Ç–∞–µ—Ç (Shift+C)
- [ ] –ú–æ–∂–Ω–æ –∏–∑–≥–∏–±–∞—Ç—å –ª–∏–Ω–∏–∏ –≤ –¥—É–≥–∏
- [ ] –ú–æ–∂–Ω–æ –ª–æ–º–∞—Ç—å –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä—ã
- [ ] Direct Selection —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ESC –æ—Ç–º–µ–Ω—è–µ—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
- [ ] Backspace —É–¥–∞–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É
- [ ] –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Glyph

---

## üöÄ –î–ê–õ–¨–ù–ï–ô–®–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –í–µ—Ä—Å–∏—è 2.0 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **Live Corners** - –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞–º–∏
2. **Snap to Grid** - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ
3. **Undo/Redo** - –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
4. **Path Simplify** - –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞
5. **Auto-Smooth** - –ê–≤—Ç–æ—Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
6. **Curve Preview** - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫—Ä–∏–≤–æ–π –ø—Ä–∏ –¥—Ä–∞–≥–µ
7. **Point Labels** - –ù—É–º–µ—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫
8. **Measurement** - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π/—É–≥–ª–æ–≤

---

## üí™ –ì–û–¢–û–í–û!

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Pen Tool** –∫–∞–∫ –≤ Adobe Illustrator!

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –≤ –ø—Ä–æ–µ–∫—Ç
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. –î–æ–±–∞–≤—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
4. –û–±—É—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
5. –ü–æ–ª—É—á–∞–π —Ñ–∏–¥–±–µ–∫
6. –£–ª—É—á—à–∞–π!

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

**–£–°–ü–ï–•–û–í!** üî•
